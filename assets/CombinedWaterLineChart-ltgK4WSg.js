import{aO as $e,m as d,v as be,r as L,aP as le,E as Se,d as K,x as Y,q as ke,av as j,s as Re,an as re,aw as Me,y as Ce,U as J,k as Be,aQ as Ne,aR as Ge,aS as ie,aD as Te,G as Ae,H as ue,o as p,c as m,e as y,F as O,l as H,t as S,b as F,aT as W,aM as V,n as X,aU as ce,_ as fe,aV as De,p as Ee}from"./index-GuCt2bA7.js";import{g as Le}from"./get-slot-Bk_rJcZu.js";function Ie(s){if(typeof s=="number")return{"":s.toString()};const t={};return s.split(/ +/).forEach(a=>{if(a==="")return;const[e,l]=a.split(":");l===void 0?t[""]=e:t[e]=l}),t}function P(s,t){var a;if(s==null)return;const e=Ie(s);if(t===void 0)return e[""];if(typeof t=="string")return(a=e[t])!==null&&a!==void 0?a:e[""];if(Array.isArray(t)){for(let l=t.length-1;l>=0;--l){const i=t[l];if(i in e)return e[i]}return e[""]}else{let l,i=-1;return Object.keys(e).forEach(f=>{const v=Number(f);!Number.isNaN(v)&&t>=v&&v>=i&&(i=v,l=e[f])}),l}}const Pe={xs:0,s:640,m:1024,l:1280,xl:1536,"2xl":1920};function Ve(s){return`(min-width: ${s}px)`}const q={};function je(s=Pe){if(!$e)return d(()=>[]);if(typeof window.matchMedia!="function")return d(()=>[]);const t=L({}),a=Object.keys(s),e=(l,i)=>{l.matches?t.value[i]=!0:t.value[i]=!1};return a.forEach(l=>{const i=s[l];let f,v;q[i]===void 0?(f=window.matchMedia(Ve(i)),f.addEventListener?f.addEventListener("change",g=>{v.forEach(_=>{_(g,l)})}):f.addListener&&f.addListener(g=>{v.forEach(_=>{_(g,l)})}),v=new Set,q[i]={mql:f,cbs:v}):(f=q[i].mql,v=q[i].cbs),v.add(e),f.matches&&v.forEach(g=>{g(f,l)})}),be(()=>{a.forEach(l=>{const{cbs:i}=q[s[l]];i.has(e)&&i.delete(e)})}),d(()=>{const{value:l}=t;return a.filter(i=>l[i])})}function Oe(s){var t;const a=(t=s.dirs)===null||t===void 0?void 0:t.find(({dir:e})=>e===le);return!!(a&&a.value===!1)}const de=1,ve=Se("n-grid"),he=1,He={span:{type:[Number,String],default:he},offset:{type:[Number,String],default:0},suffix:Boolean,privateOffset:Number,privateSpan:Number,privateColStart:Number,privateShow:{type:Boolean,default:!0}},Rt=K({__GRID_ITEM__:!0,name:"GridItem",alias:["Gi"],props:He,setup(){const{isSsrRef:s,xGapRef:t,itemStyleRef:a,overflowRef:e,layoutShiftDisabledRef:l}=ke(ve),i=Re();return{overflow:e,itemStyle:a,layoutShiftDisabled:l,mergedXGap:d(()=>j(t.value||0)),deriveStyle:()=>{s.value;const{privateSpan:f=he,privateShow:v=!0,privateColStart:g=void 0,privateOffset:_=0}=i.vnode.props,{value:w}=t,x=j(w||0);return{display:v?"":"none",gridColumn:`${g??`span ${f}`} / span ${f}`,marginLeft:_?`calc((100% - (${f} - 1) * ${x}) / ${f} * ${_} + ${x} * ${_})`:""}}}},render(){var s,t;if(this.layoutShiftDisabled){const{span:a,offset:e,mergedXGap:l}=this;return Y("div",{style:{gridColumn:`span ${a} / span ${a}`,marginLeft:e?`calc((100% - (${a} - 1) * ${l}) / ${a} * ${e} + ${l} * ${e})`:""}},this.$slots)}return Y("div",{style:[this.itemStyle,this.deriveStyle()]},(t=(s=this.$slots).default)===null||t===void 0?void 0:t.call(s,{overflow:this.overflow}))}}),Xe={xs:0,s:640,m:1024,l:1280,xl:1536,xxl:1920},pe=24,ne="__ssr__",ze={layoutShiftDisabled:Boolean,responsive:{type:[String,Boolean],default:"self"},cols:{type:[Number,String],default:pe},itemResponsive:Boolean,collapsed:Boolean,collapsedRows:{type:Number,default:1},itemStyle:[Object,String],xGap:{type:[Number,String],default:0},yGap:{type:[Number,String],default:0}},Mt=K({name:"Grid",inheritAttrs:!1,props:ze,setup(s){const{mergedClsPrefixRef:t,mergedBreakpointsRef:a}=Ce(s),e=/^\d+$/,l=L(void 0),i=je((a==null?void 0:a.value)||Xe),f=J(()=>!!(s.itemResponsive||!e.test(s.cols.toString())||!e.test(s.xGap.toString())||!e.test(s.yGap.toString()))),v=d(()=>{if(f.value)return s.responsive==="self"?l.value:i.value}),g=J(()=>{var h;return(h=Number(P(s.cols.toString(),v.value)))!==null&&h!==void 0?h:pe}),_=J(()=>P(s.xGap.toString(),v.value)),w=J(()=>P(s.yGap.toString(),v.value)),x=h=>{l.value=h.contentRect.width},c=h=>{Te(x,h)},$=L(!1),R=d(()=>{if(s.responsive==="self")return c}),k=L(!1),B=L();return Be(()=>{const{value:h}=B;h&&h.hasAttribute(ne)&&(h.removeAttribute(ne),k.value=!0)}),Ae(ve,{layoutShiftDisabledRef:ue(s,"layoutShiftDisabled"),isSsrRef:k,itemStyleRef:ue(s,"itemStyle"),xGapRef:_,overflowRef:$}),{isSsr:!Ne,contentEl:B,mergedClsPrefix:t,style:d(()=>s.layoutShiftDisabled?{width:"100%",display:"grid",gridTemplateColumns:`repeat(${s.cols}, minmax(0, 1fr))`,columnGap:j(s.xGap),rowGap:j(s.yGap)}:{width:"100%",display:"grid",gridTemplateColumns:`repeat(${g.value}, minmax(0, 1fr))`,columnGap:j(_.value),rowGap:j(w.value)}),isResponsive:f,responsiveQuery:v,responsiveCols:g,handleResize:R,overflow:$}},render(){if(this.layoutShiftDisabled)return Y("div",re({ref:"contentEl",class:`${this.mergedClsPrefix}-grid`,style:this.style},this.$attrs),this.$slots);const s=()=>{var t,a,e,l,i,f,v;this.overflow=!1;const g=Ge(Le(this)),_=[],{collapsed:w,collapsedRows:x,responsiveCols:c,responsiveQuery:$}=this;g.forEach(u=>{var D,M,C,N,z;if(((D=u==null?void 0:u.type)===null||D===void 0?void 0:D.__GRID_ITEM__)!==!0)return;if(Oe(u)){const A=ie(u);A.props?A.props.privateShow=!1:A.props={privateShow:!1},_.push({child:A,rawChildSpan:0});return}u.dirs=((M=u.dirs)===null||M===void 0?void 0:M.filter(({dir:A})=>A!==le))||null,((C=u.dirs)===null||C===void 0?void 0:C.length)===0&&(u.dirs=null);const U=ie(u),Z=Number((z=P((N=U.props)===null||N===void 0?void 0:N.span,$))!==null&&z!==void 0?z:de);Z!==0&&_.push({child:U,rawChildSpan:Z})});let R=0;const k=(t=_[_.length-1])===null||t===void 0?void 0:t.child;if(k!=null&&k.props){const u=(a=k.props)===null||a===void 0?void 0:a.suffix;u!==void 0&&u!==!1&&(R=Number((l=P((e=k.props)===null||e===void 0?void 0:e.span,$))!==null&&l!==void 0?l:de),k.props.privateSpan=R,k.props.privateColStart=c+1-R,k.props.privateShow=(i=k.props.privateShow)!==null&&i!==void 0?i:!0)}let B=0,h=!1;for(const{child:u,rawChildSpan:D}of _){if(h&&(this.overflow=!0),!h){const M=Number((v=P((f=u.props)===null||f===void 0?void 0:f.offset,$))!==null&&v!==void 0?v:0),C=Math.min(D+M,c);if(u.props?(u.props.privateSpan=C,u.props.privateOffset=M):u.props={privateSpan:C,privateOffset:M},w){const N=B%c;C+N>c&&(B+=c-N),C+B+R>x*c?h=!0:B+=C}}h&&(u.props?u.props.privateShow!==!0&&(u.props.privateShow=!1):u.props={privateShow:!1})}return Y("div",re({ref:"contentEl",class:`${this.mergedClsPrefix}-grid`,style:this.style,[ne]:this.isSsr||void 0},this.$attrs),_.map(({child:u})=>u))};return this.isResponsive&&this.responsive==="self"?Y(Me,{onResize:this.handleResize},{default:s}):s()}}),Qe={class:"allocation-wrap"},qe={key:0,class:"allocation-layout"},Fe=["viewBox"],We=["transform"],Ye=["stroke","stroke-dasharray","stroke-dashoffset","onMouseenter"],Ue={class:"donut-core"},Ze={class:"core-label"},Je={class:"core-value"},Ke={key:0,class:"core-share"},et={class:"side-panel"},tt=["onMouseenter"],st={class:"legend-name"},nt={class:"legend-share"},at={key:1,class:"empty"},ae=220,oe=30,ot=K({__name:"AssetAllocationDonutChart",props:{rows:{}},setup(s){const t=s,a=L(null),e=ae/2,l=e-oe/2-4,i=2*Math.PI*l,f=d(()=>t.rows.reduce((w,x)=>w+x.valueTwd,0)),v=d(()=>{let w=0;return t.rows.map(x=>{const c=Math.max(0,x.share)/100,$=i*c,R={...x,dasharray:`${$} ${Math.max(0,i-$)}`,dashoffset:-w};return w+=$,R})}),g=d(()=>a.value?t.rows.find(w=>w.key===a.value)??null:null);function _(w){return`${Math.round(w)}%`}return(w,x)=>(p(),m("div",Qe,[s.rows.length>0?(p(),m("div",qe,[y("div",{class:"donut-shell",onMouseleave:x[0]||(x[0]=c=>a.value=null)},[(p(),m("svg",{viewBox:`0 0 ${ae} ${ae}`,class:"donut-svg",role:"img","aria-label":"資產佔比圖"},[y("circle",{cx:e,cy:e,r:l,"stroke-width":oe,class:"donut-track"}),y("g",{transform:`rotate(-90 ${e} ${e})`},[(p(!0),m(O,null,H(v.value,c=>(p(),m("circle",{key:c.key,cx:e,cy:e,r:l,class:X(["donut-segment",{"is-active":a.value===c.key}]),stroke:c.color,"stroke-width":oe,"stroke-dasharray":c.dasharray,"stroke-dashoffset":c.dashoffset,onMouseenter:$=>a.value=c.key},null,42,Ye))),128))],8,We)],8,Fe)),y("div",Ue,[y("div",Ze,S(g.value?g.value.label:"資產佔比"),1),y("div",Je,S(F(W)(g.value?g.value.valueTwd:f.value)),1),g.value?(p(),m("div",Ke,S(_(g.value.share)),1)):V("",!0)])],32),y("div",et,[y("div",{class:"legend",onMouseleave:x[1]||(x[1]=c=>a.value=null)},[(p(!0),m(O,null,H(s.rows,c=>(p(),m("div",{key:c.key,class:X(["legend-row",{"legend-active":a.value===c.key}]),onMouseenter:$=>a.value=c.key},[y("span",{class:"legend-dot",style:ce({background:c.color})},null,4),y("span",st,S(c.label),1),y("span",nt,S(Math.round(c.share))+"%",1)],42,tt))),128))],32)])])):(p(),m("div",at,"本月沒有可用資產資料"))]))}}),Ct=fe(ot,[["__scopeId","data-v-23fdf019"]]),lt={key:0,class:"empty"},rt=["viewBox"],it=["x1","y1","x2","y2"],ut=["x1","y1","x2","y2"],dt=["x1","y1","x2","y2"],ct=["x","y"],ft=["d"],vt=["points"],ht=["cx","cy","r","onMouseenter"],pt=["cx","cy","r"],mt=["x","y","text-anchor"],yt=["x","y"],gt={class:"tip-head"},xt={key:0,class:"tip-list"},_t={class:"tip-name"},wt={key:0,class:"tip-more"},T=980,$t=280,bt=K({__name:"CombinedWaterLineChart",props:{points:{},details:{},showBreakdown:{type:Boolean},maxBreakdownRows:{},chartHeight:{},showPointValues:{type:Boolean},preset:{}},setup(s){const t=s,a=d(()=>t.preset==="dashboard"),e=d(()=>a.value?{top:28,right:168,bottom:78,left:84}:{top:20,right:92,bottom:52,left:28}),l=d(()=>Math.max(240,t.chartHeight??$t)),i=d(()=>l.value-e.value.bottom),f=d(()=>a.value?13:9),v=d(()=>a.value?5.2:3.8),g=d(()=>a.value?16:11),_=d(()=>a.value?32:22),w=d(()=>t.points.map(o=>o.totalTwd)),x=L(null),c=d(()=>{if(w.value.length===0)return{min:0,max:100,step:20};const o=Math.min(...w.value),r=Math.max(...w.value);if(o===r){if(o===0)return{min:0,max:100,step:20};const E=Math.pow(10,Math.floor(Math.log10(Math.abs(o))))||10;return{min:Math.floor(o/E)*E-E,max:Math.ceil(r/E)*E+E,step:E}}const Q=(r-o)*1.25/5,I=Math.pow(10,Math.floor(Math.log10(Q))),ee=Q/I;let b=I;ee<=1?b=1*I:ee<=2?b=2*I:ee<=5?b=5*I:b=10*I,b=Math.max(1,Math.round(b));const te=Math.floor(o/b)*b,se=Math.ceil(r/b)*b,_e=o-te<b*.1?te-b:te,we=se-r<b*.1?se+b:se;return{min:_e,max:we,step:b}});function $(o){const r=T-e.value.left-e.value.right;return t.points.length<=1?e.value.left+r/2:e.value.left+r*o/(t.points.length-1)}function R(o){const r=l.value-e.value.top-e.value.bottom,n=c.value,G=(o-n.min)/(n.max-n.min);return e.value.top+r-G*r}const k=d(()=>t.points.map((o,r)=>`${$(r)},${R(o.totalTwd)}`).join(" ")),B=d(()=>{if(h.value.length===0)return"";const r=`M ${h.value[0].x} ${i.value}`,n=h.value.map(Q=>`L ${Q.x} ${Q.y}`).join(" "),G=`L ${h.value[h.value.length-1].x} ${i.value} Z`;return`${r} ${n} ${G}`}),h=d(()=>t.points.map((o,r)=>({...o,index:r,x:$(r),y:R(o.totalTwd)}))),u=d(()=>x.value===null?null:h.value[x.value]??null),D=d(()=>{const o=new Map;for(const r of t.details??[])o.set(r.key,r);return o}),M=d(()=>{const o=u.value;return o?D.value.get(o.key)??null:null}),C=d(()=>{if(!t.showBreakdown||!M.value)return[];const o=Math.max(1,t.maxBreakdownRows??6);return M.value.breakdown.slice(0,o)}),N=d(()=>{if(!t.showBreakdown||!M.value)return 0;const o=Math.max(1,t.maxBreakdownRows??6);return Math.max(0,M.value.breakdown.length-o)}),z=d(()=>{const o=c.value,r=[];for(let n=o.max;n>=o.min;n-=o.step)r.push({y:R(n),value:n});return r}),U=d(()=>t.points.length<=8?1:Math.ceil(t.points.length/8));function Z(o){return Ee(o)}function A(o){const[r,n]=o.split("-");return!r||!n?o:`${r}/${n}`}function me(o,r,n){return n<=1?r:o===0?r+(a.value?8:6):o===n-1?r-(a.value?10:6):r}function ye(o,r){return r<=1?"middle":o===0?"start":o===r-1?"end":"middle"}const ge=d(()=>u.value?{left:`${u.value.x/T*100}%`,top:`${u.value.y/l.value*100}%`}:{}),xe=d(()=>u.value?u.value.x>T*.62?"tip-left":"tip-right":"");return(o,r)=>(p(),m("div",{class:X(["chart-shell",{"preset-dashboard":a.value}])},[s.points.length===0?(p(),m("div",lt,"目前區間沒有資料")):(p(),m("svg",{key:1,viewBox:`0 0 ${T} ${l.value}`,class:"chart-svg",role:"img","aria-label":"選取帳戶加總水位折線圖",onMouseleave:r[0]||(r[0]=n=>x.value=null)},[y("line",{x1:e.value.left,y1:i.value,x2:T-e.value.right,y2:i.value,class:"axis"},null,8,it),y("line",{x1:T-e.value.right,y1:e.value.top,x2:T-e.value.right,y2:i.value,class:"axis"},null,8,ut),(p(!0),m(O,null,H(z.value,n=>(p(),m("g",{key:n.y},[y("line",{x1:e.value.left,y1:n.y,x2:T-e.value.right,y2:n.y,class:"grid-line"},null,8,dt),y("text",{x:T-e.value.right+16,y:n.y+6,class:"y-label"},S(Z(n.value)),9,ct)]))),128)),B.value?(p(),m("path",{key:0,d:B.value,class:"area-fill"},null,8,ft)):V("",!0),y("polyline",{points:k.value,class:"trend-line"},null,8,vt),(p(!0),m(O,null,H(h.value,n=>(p(),m("g",{key:n.key},[y("circle",{cx:n.x,cy:n.y,r:f.value,class:"dot-hit",onMouseenter:G=>x.value=n.index},null,40,ht),y("circle",{cx:n.x,cy:n.y,r:v.value,class:X(["dot",{"dot-active":x.value===n.index}])},[y("title",null,S(n.month)+" "+S(F(W)(n.totalTwd)),1)],10,pt),x.value===n.index?(p(),m("text",{key:0,x:me(n.index,n.x,h.value.length),y:n.y-g.value,"text-anchor":ye(n.index,h.value.length),class:"edge-value"},S(F(W)(n.totalTwd)),9,mt)):V("",!0)]))),128)),(p(!0),m(O,null,H(s.points,(n,G)=>De((p(),m("text",{key:`label-${n.key}`,x:$(G),y:i.value+_.value,class:"x-label"},S(A(n.month)),9,yt)),[[le,G%U.value===0||G===s.points.length-1]])),128))],40,rt)),u.value?(p(),m("div",{key:2,class:X(["hover-tip",xe.value]),style:ce(ge.value)},[y("div",gt,[y("span",null,S(u.value.month),1),y("strong",null,S(F(W)(u.value.totalTwd)),1)]),s.showBreakdown&&C.value.length>0?(p(),m("div",xt,[(p(!0),m(O,null,H(C.value,n=>(p(),m("div",{key:`${u.value.key}-${n.accountId}`,class:"tip-row"},[y("span",_t,S(n.accountName),1),y("span",{class:X(["tip-impact",n.type==="asset"?"is-up":"is-down"])},S(F(W)(n.signedTwd)),3)]))),128)),N.value>0?(p(),m("div",wt,"+"+S(N.value)+" 個帳戶",1)):V("",!0)])):V("",!0)],6)):V("",!0)],2))}}),Bt=fe(bt,[["__scopeId","data-v-6c585a93"]]);export{Ct as A,Bt as C,Mt as N,Rt as a};
