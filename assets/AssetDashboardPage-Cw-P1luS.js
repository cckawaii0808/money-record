import{d as be,u as we,i as ye,j as Te,k as _e,c as W,a as l,w as r,b as s,r as B,o as G,N as h,e as u,t as v,n as z,F as De,l as ke,D as Me,m as i,B as xe,g as Ae,p as k,A as j,_ as Ne}from"./index-DAeJiUV8.js";import{N as K,a as b,C as Ce,A as Re}from"./CombinedWaterLineChart-C6lbiEBu.js";import{N as $e}from"./DatePicker-B4q-CAwa.js";import"./get-slot-Bk_rJcZu.js";const Le={class:"page-container"},Pe={class:"kpi-value"},Ie={class:"kpi-value"},Ee={class:"kpi-value"},Ye={class:"panel-title"},Fe={class:"trend-toolbar"},Oe={class:"range-actions"},Se={class:"trend-chart-wrap"},Ve=be({__name:"AssetDashboardPage",setup(We){const M=we(),{accountSnapshotRows:U,trendRows:R,combinedWaterPoints:q,formatPct:H,monthRangeValue:w,isMonthOutOfRange:J,rangeEndMonth:x,selectedMonth:A,maxMonth:$,selectAllAccounts:Q,selectLatestMonth:X}=ye(),c=B("six-month"),y=i(()=>R.value[R.value.length-1]??null),T=i(()=>{var e;return Math.round(((e=y.value)==null?void 0:e.delta)??0)}),Z=i(()=>{var e;return((e=y.value)==null?void 0:e.pct)??null}),ee=i(()=>{var e;return Math.round(((e=y.value)==null?void 0:e.netTwd)??0)}),te=i(()=>{var e;return Math.round(((e=y.value)==null?void 0:e.assetTwd)??0)}),ae=i(()=>{var e;return Math.round(((e=y.value)==null?void 0:e.liabilityTwd)??0)}),ne=i(()=>q.value.slice(-6)),se=i(()=>{const e=ne.value;if(e.length<=1)return e;const t=[],a=n=>{t.some(o=>o.key===n.key)||t.push(n)};for(let n=0;n<e.length-1;n+=1){const o=e[n],d=e[n+1];a(o);const[f,p]=o.month.split("-").map(Number),[_,O]=d.month.split("-").map(Number);if(!f||!p||!_||!O)continue;const C=new Date(f,p-1,1),S=new Date(_,O-1,1),V=S.getTime()-C.getTime();if(!(V<=0))for(let D=7;D<31;D+=7){const g=new Date(C);if(g.setDate(g.getDate()+D),g>=S)break;const pe=(g.getTime()-C.getTime())/V,ge=o.totalTwd+(d.totalTwd-o.totalTwd)*pe,he=`${g.getMonth()+1}/${`${g.getDate()}`.padStart(2,"0")}`;a({key:`${o.key}-w${D}`,month:he,totalTwd:ge})}}return a(e[e.length-1]),t}),le={"three-month":"3個月","six-month":"6個月","this-year":"今年",custom:"區間"},oe=["three-month","six-month","this-year"],L=new Date(2020,0,1).getTime(),P=i(()=>{const[e,t]=$.value.split("-").map(Number);return e&&t?new Date(e,t-1,28).getTime():Date.now()}),m=B(null);function I(e){const t=new Date(e),a=t.getFullYear(),n=`${t.getMonth()+1}`.padStart(2,"0"),o=`${t.getDate()}`.padStart(2,"0");return`${a}/${n}/${o}`}const re=i(()=>{if(c.value==="three-month")return"最近 3 個月淨值走勢";if(c.value==="six-month")return"最近 6 個月淨值走勢";if(c.value==="this-year")return"今年淨值走勢";const e=w.value??m.value;return e?`指定區間淨值走勢（${I(e[0])} - ${I(e[1])}）`:"指定區間淨值走勢"});function N(e){const[t,a]=e,n=L,o=P.value,d=Math.min(Math.max(t,n),o),f=Math.min(Math.max(a,n),o),p=d<=f?[d,f]:[f,d],_=p[0]!==t||p[1]!==a;return{range:p,changed:_}}const E=i({get(){return m.value},set(e){if(!e)return;const{range:t,changed:a}=N(e);m.value=t,a&&M.warning("可選範圍為 2020/01/01 到今天",{duration:1e3})}});function ie(e){if(!e)return;const{range:t,changed:a}=N(e);m.value=t,w.value=t,c.value="custom",A.value=x.value,a&&M.warning("可選範圍為 2020/01/01 到今天",{duration:1e3})}function ue(e){Array.isArray(e)&&ie([e[0],e[1]])}const de=i(()=>k(ee.value)),ce=i(()=>k(te.value)),me=i(()=>k(ae.value)),ve=i(()=>`${T.value>0?"+":""}${k(T.value)}`),Y=i(()=>T.value>0?"tone-up":T.value<0?"tone-down":"tone-flat"),fe=i(()=>{const e=U.value.filter(a=>a.type==="asset"&&a.netImpactTwd>0).sort((a,n)=>n.netImpactTwd-a.netImpactTwd),t=e.reduce((a,n)=>a+n.netImpactTwd,0);return t<=0?[]:e.map((a,n)=>({key:a.key,label:a.accountName,valueTwd:a.netImpactTwd,share:a.netImpactTwd/t*100,color:j[n%j.length]}))});function F(e){if(e==="custom"){if(!m.value){M.warning("請先選擇日期區間",{duration:1e3});return}w.value=m.value,c.value="custom",A.value=x.value;return}c.value=e;const[t,a]=$.value.split("-").map(Number),n=t&&a?new Date(t,a-1,28):new Date;let o=new Date(n);e==="three-month"?o=new Date(n.getFullYear(),n.getMonth()-2,1):e==="six-month"?o=new Date(n.getFullYear(),n.getMonth()-5,1):e==="this-year"&&(o=new Date(n.getFullYear(),0,1));const{range:d}=N([o.getTime(),n.getTime()]);m.value=d,w.value=d,A.value=x.value}return Te(w,e=>{e&&(m.value=[...e])},{immediate:!0}),_e(()=>{Q(),X(),F("six-month")}),(e,t)=>(G(),W("div",Le,[l(s(K),{"x-gap":10,"y-gap":10,cols:"2 s:2 m:4 l:4",responsive:"screen"},{default:r(()=>[l(s(b),null,{default:r(()=>[l(s(h),{class:"kpi-card kpi-net",bordered:!1},{default:r(()=>[t[1]||(t[1]=u("div",{class:"kpi-label"},"總淨值（TWD）",-1)),u("div",Pe,v(de.value),1)]),_:1})]),_:1}),l(s(b),null,{default:r(()=>[l(s(h),{class:"kpi-card",bordered:!1},{default:r(()=>[t[2]||(t[2]=u("div",{class:"kpi-label"},"本月變化",-1)),u("div",{class:z(["kpi-value",Y.value])},v(ve.value),3),u("div",{class:z(["kpi-foot",Y.value])},v(s(H)(Z.value)),3)]),_:1})]),_:1}),l(s(b),null,{default:r(()=>[l(s(h),{class:"kpi-card",bordered:!1},{default:r(()=>[t[3]||(t[3]=u("div",{class:"kpi-label"},"總資產（TWD）",-1)),u("div",Ie,v(ce.value),1)]),_:1})]),_:1}),l(s(b),null,{default:r(()=>[l(s(h),{class:"kpi-card",bordered:!1},{default:r(()=>[t[4]||(t[4]=u("div",{class:"kpi-label"},"總負債（TWD）",-1)),u("div",Ee,v(me.value),1)]),_:1})]),_:1})]),_:1}),l(s(K),{class:"charts-grid","x-gap":16,"y-gap":16,cols:"1 s:1 m:2 l:2",responsive:"screen"},{default:r(()=>[l(s(b),null,{default:r(()=>[l(s(h),{class:"panel-card chart-panel",bordered:!1},{header:r(()=>[u("div",Ye,v(re.value),1)]),default:r(()=>[u("div",Fe,[u("div",Oe,[(G(),W(De,null,ke(oe,a=>l(s(xe),{key:a,size:"small",type:c.value===a?"primary":"default",secondary:c.value!==a,class:"range-tab",onClick:n=>F(a)},{default:r(()=>[Ae(v(le[a]),1)]),_:2},1032,["type","secondary","onClick"])),64))]),l(s($e),{value:E.value,"onUpdate:value":t[0]||(t[0]=a=>E.value=a),type:"daterange",format:"yyyy/MM/dd",clearable:!1,"is-date-disabled":s(J),"year-range":s(Me),"default-calendar-start-time":s(L),"default-calendar-end-time":P.value,class:"range-picker",onConfirm:ue},null,8,["value","is-date-disabled","year-range","default-calendar-start-time","default-calendar-end-time"])]),u("div",Se,[l(Ce,{points:se.value,"chart-height":560,"show-point-values":!1,preset:"dashboard"},null,8,["points"])])]),_:1})]),_:1}),l(s(b),null,{default:r(()=>[l(s(h),{class:"panel-card chart-panel",bordered:!1},{header:r(()=>[...t[5]||(t[5]=[u("div",{class:"panel-title"},"資產佔比",-1)])]),default:r(()=>[l(Re,{rows:fe.value},null,8,["rows"])]),_:1})]),_:1})]),_:1})]))}}),Ke=Ne(Ve,[["__scopeId","data-v-63bbb7ac"]]);export{Ke as default};
