import{d as Te,u as _e,i as De,j as ke,k as Me,c as G,a as r,w as i,b as l,r as P,o as U,N as b,e as d,t as h,n as j,F as xe,l as Ae,D as Ne,g as K,m as u,B as Le,p as M,A as q,_ as Ce}from"./index-uAypqIvn.js";import{N as H,a as y,C as Ie,A as Pe,b as Re}from"./CombinedWaterLineChart-BdaUrbmS.js";import{N as $e}from"./DatePicker-Br_FoCCy.js";import"./get-slot-Bk_rJcZu.js";const Ee={class:"page-container"},Ye={class:"kpi-value"},Be={class:"kpi-value"},Fe={class:"kpi-value"},Oe={class:"panel-title"},Se={class:"trend-toolbar"},Ve={class:"range-actions"},We={class:"trend-chart-wrap"},ze={class:"allocation-header"},Ge=Te({__name:"AssetDashboardPage",setup(Ue){const x=_e(),{accountSnapshotRows:J,trendRows:R,combinedWaterPoints:Q,formatPct:X,monthRangeValue:w,isMonthOutOfRange:Z,rangeEndMonth:A,selectedMonth:N,maxMonth:$,selectAllAccounts:ee,selectLatestMonth:te}=De(),f=P("six-month"),T=u(()=>R.value[R.value.length-1]??null),_=u(()=>{var e;return Math.round(((e=T.value)==null?void 0:e.delta)??0)}),ae=u(()=>{var e;return((e=T.value)==null?void 0:e.pct)??null}),ne=u(()=>{var e;return Math.round(((e=T.value)==null?void 0:e.netTwd)??0)}),se=u(()=>{var e;return Math.round(((e=T.value)==null?void 0:e.assetTwd)??0)}),le=u(()=>{var e;return Math.round(((e=T.value)==null?void 0:e.liabilityTwd)??0)}),oe=u(()=>Q.value.slice(-6)),re=u(()=>{const e=oe.value;if(e.length<=1)return e;const t=[],a=n=>{t.some(o=>o.key===n.key)||t.push(n)};for(let n=0;n<e.length-1;n+=1){const o=e[n],c=e[n+1];a(o);const[p,s]=o.month.split("-").map(Number),[m,D]=c.month.split("-").map(Number);if(!p||!s||!m||!D)continue;const I=new Date(p,s-1,1),W=new Date(m,D-1,1),z=W.getTime()-I.getTime();if(!(z<=0))for(let k=7;k<31;k+=7){const g=new Date(I);if(g.setDate(g.getDate()+k),g>=W)break;const be=(g.getTime()-I.getTime())/z,ye=o.totalTwd+(c.totalTwd-o.totalTwd)*be,we=`${g.getMonth()+1}/${`${g.getDate()}`.padStart(2,"0")}`;a({key:`${o.key}-w${k}`,month:we,totalTwd:ye})}}return a(e[e.length-1]),t}),ie={"three-month":"3個月","six-month":"6個月","this-year":"今年",custom:"區間"},ue=["three-month","six-month","this-year"],E=new Date(2020,0,1).getTime(),Y=u(()=>{const[e,t]=$.value.split("-").map(Number);return e&&t?new Date(e,t-1,28).getTime():Date.now()}),v=P(null);function B(e){const t=new Date(e),a=t.getFullYear(),n=`${t.getMonth()+1}`.padStart(2,"0"),o=`${t.getDate()}`.padStart(2,"0");return`${a}/${n}/${o}`}const de=u(()=>{if(f.value==="three-month")return"最近 3 個月淨值走勢";if(f.value==="six-month")return"最近 6 個月淨值走勢";if(f.value==="this-year")return"今年淨值走勢";const e=w.value??v.value;return e?`指定區間淨值走勢（${B(e[0])} - ${B(e[1])}）`:"指定區間淨值走勢"});function L(e){const[t,a]=e,n=E,o=Y.value,c=Math.min(Math.max(t,n),o),p=Math.min(Math.max(a,n),o),s=c<=p?[c,p]:[p,c],m=s[0]!==t||s[1]!==a;return{range:s,changed:m}}const F=u({get(){return v.value},set(e){if(!e)return;const{range:t,changed:a}=L(e);v.value=t,a&&x.warning("可選範圍為 2020/01/01 到今天",{duration:1e3})}});function ce(e){if(!e)return;const{range:t,changed:a}=L(e);v.value=t,w.value=t,f.value="custom",N.value=A.value,a&&x.warning("可選範圍為 2020/01/01 到今天",{duration:1e3})}function me(e){Array.isArray(e)&&ce([e[0],e[1]])}const fe=u(()=>M(ne.value)),ve=u(()=>M(se.value)),pe=u(()=>M(le.value)),he=u(()=>`${_.value>0?"+":""}${M(_.value)}`),O=u(()=>_.value>0?"tone-up":_.value<0?"tone-down":"tone-flat"),C=P(!1),S=["#ef4444","#f87171","#fb923c","#fbbf24","#fca5a5"],ge=u(()=>{const e=J.value,t=e.filter(s=>s.type==="asset"&&s.netImpactTwd>0),a=C.value?e.filter(s=>s.type==="liability"&&s.netImpactTwd<0):[],n=[...t,...a].sort((s,m)=>Math.abs(m.netImpactTwd)-Math.abs(s.netImpactTwd)),o=n.reduce((s,m)=>s+Math.abs(m.netImpactTwd),0);if(o<=0)return[];let c=0,p=0;return n.map(s=>{const D=s.type==="liability"?S[p++%S.length]:q[c++%q.length];return{key:s.key,label:s.accountName,valueTwd:s.netImpactTwd,share:Math.abs(s.netImpactTwd)/o*100,color:D}})});function V(e){if(e==="custom"){if(!v.value){x.warning("請先選擇日期區間",{duration:1e3});return}w.value=v.value,f.value="custom",N.value=A.value;return}f.value=e;const[t,a]=$.value.split("-").map(Number),n=t&&a?new Date(t,a-1,28):new Date;let o=new Date(n);e==="three-month"?o=new Date(n.getFullYear(),n.getMonth()-2,1):e==="six-month"?o=new Date(n.getFullYear(),n.getMonth()-5,1):e==="this-year"&&(o=new Date(n.getFullYear(),0,1));const{range:c}=L([o.getTime(),n.getTime()]);v.value=c,w.value=c,N.value=A.value}return ke(w,e=>{e&&(v.value=[...e])},{immediate:!0}),Me(()=>{ee(),te(),V("six-month")}),(e,t)=>(U(),G("div",Ee,[r(l(H),{"x-gap":10,"y-gap":10,cols:"2 s:2 m:4 l:4",responsive:"screen"},{default:i(()=>[r(l(y),null,{default:i(()=>[r(l(b),{class:"kpi-card kpi-net",bordered:!1},{default:i(()=>[t[2]||(t[2]=d("div",{class:"kpi-label"},"總淨值（TWD）",-1)),d("div",Ye,h(fe.value),1)]),_:1})]),_:1}),r(l(y),null,{default:i(()=>[r(l(b),{class:"kpi-card",bordered:!1},{default:i(()=>[t[3]||(t[3]=d("div",{class:"kpi-label"},"本月變化",-1)),d("div",{class:j(["kpi-value",O.value])},h(he.value),3),d("div",{class:j(["kpi-foot",O.value])},h(l(X)(ae.value)),3)]),_:1})]),_:1}),r(l(y),null,{default:i(()=>[r(l(b),{class:"kpi-card",bordered:!1},{default:i(()=>[t[4]||(t[4]=d("div",{class:"kpi-label"},"總資產（TWD）",-1)),d("div",Be,h(ve.value),1)]),_:1})]),_:1}),r(l(y),null,{default:i(()=>[r(l(b),{class:"kpi-card",bordered:!1},{default:i(()=>[t[5]||(t[5]=d("div",{class:"kpi-label"},"總負債（TWD）",-1)),d("div",Fe,h(pe.value),1)]),_:1})]),_:1})]),_:1}),r(l(H),{class:"charts-grid","x-gap":16,"y-gap":16,cols:"1 s:1 m:2 l:2",responsive:"screen"},{default:i(()=>[r(l(y),null,{default:i(()=>[r(l(b),{class:"panel-card chart-panel",bordered:!1},{header:i(()=>[d("div",Oe,h(de.value),1)]),default:i(()=>[d("div",Se,[d("div",Ve,[(U(),G(xe,null,Ae(ue,a=>r(l(Le),{key:a,size:"small",type:f.value===a?"primary":"default",secondary:f.value!==a,class:"range-tab",onClick:n=>V(a)},{default:i(()=>[K(h(ie[a]),1)]),_:2},1032,["type","secondary","onClick"])),64))]),r(l($e),{value:F.value,"onUpdate:value":t[0]||(t[0]=a=>F.value=a),type:"daterange",format:"yyyy/MM/dd",clearable:!1,"is-date-disabled":l(Z),"year-range":l(Ne),"default-calendar-start-time":l(E),"default-calendar-end-time":Y.value,class:"range-picker",onConfirm:me},null,8,["value","is-date-disabled","year-range","default-calendar-start-time","default-calendar-end-time"])]),d("div",We,[r(Ie,{points:re.value,"chart-height":560,"show-point-values":!1,preset:"dashboard"},null,8,["points"])])]),_:1})]),_:1}),r(l(y),null,{default:i(()=>[r(l(b),{class:"panel-card chart-panel",bordered:!1},{header:i(()=>[d("div",ze,[t[7]||(t[7]=d("div",{class:"panel-title"},"資產佔比",-1)),r(l(Re),{checked:C.value,"onUpdate:checked":t[1]||(t[1]=a=>C.value=a),size:"small"},{default:i(()=>[...t[6]||(t[6]=[K("含負債",-1)])]),_:1},8,["checked"])])]),default:i(()=>[r(Pe,{rows:ge.value},null,8,["rows"])]),_:1})]),_:1})]),_:1})]))}}),Je=Ce(Ge,[["__scopeId","data-v-4058f2f6"]]);export{Je as default};
